# 以太坊账户  

比特币是基于交易的账本，这种模式下，系统中并不会显式记录某个用户名下有多少个比特币。要想知道某个用户有多少比特币，只能通过UTXO查找。这种模式提供了一定的隐匿性，但缺点就是可能用户自己都不知道自己有多少比特币。所以每次交易时都需要说明币的来源。同时因为没有账户的概念，所以交易执行结束之后通常还需要指定一个接收找零的地址，否则差额将会全部支付给矿工。  

以太坊是基于账户的账本，与现实中的银行账户类似。系统中会显式的记录每个账户的以太币的数量，转账时只需要查看转账者账户中是否有足够即可，也不用每次都将币全部花出去。这种模式天然的防范了**双花攻击**。账户中的余额是在全节点的状态树中维护的。  

但这也会带来新的问题：**重放攻击**。假如A给B转了10ETH，因为所有的交易都是公开的，过段时间时候，B可以将这个交易再发布一遍，这样系统就会认为A又给B转了10ETH。所以为了防范重放攻击，所以以太坊引入了交易计数nonce，记录每个账户执行过多少次交易。交易时，A会将转账金额和nonce签名后发布到网络中。全节点接收到之后会检查nonce的值。交易中的nonce为21，全节点中记录的nonce是20，此时全节点认为该交易是合法的，执行交易并将自己维护的nonce+1。重放攻击时，交易中的nonce为21，但系统的改用的nonce也是21，即这笔交易已经执行过，不再执行这笔交易，从而避免了重放攻击。  

## 账户类型  

以太坊中的账户分为两种类型：  

- **外部账户**：类似比特币中账户，使用公私钥对控制。也称普通账户。外部账户包含余额和nonce。
- **合约账户**：不是通过公私钥对进行控制。以太坊中规定，合约账户不能主动发起交易，所有的交易都必须由外部账户发起。除了包含余额和nonce之外，还包含代码和相关的状态。创建合约的时候会返回合约的地址，通过地址就可以调用该合约。  

## 为什么要使用账户  

基于交易的账本，好处在于隐匿性比较好；但以太坊中的智能合约，需要签约双方明确且较少变化。尤其是对合约账户来说，更需要保持稳定。  

---

> 声明：本作品采用[署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0)](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)进行许可，使用时请注明出处。  

---